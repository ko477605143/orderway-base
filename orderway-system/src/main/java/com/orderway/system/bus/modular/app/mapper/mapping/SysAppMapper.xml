<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.orderway.system.bus.modular.app.mapper.SysAppMapper">

    <select id="getDictCodeAndValueByDictTypeId" resultType="map">
        select value, code
        from sys_dict_data
        where type_id = #{dictTypeId}
        order by sort asc
    </select>

    <select id="page" resultType="map">
        SELECT t1.name
             , t1.code
             , t1.active
             , t1.status
             , t1.client_type
             , t2.value
             , t1.app_id
             , t1.app_key
             , t1.url
             , t1.id
             , t1.status
        FROM sys_app t1
                 left join (
            select value,
                   code
            from sys_dict_data
            where type_id = '1570302382370021378'
        ) t2
                           on t1.client_type = t2.code
            ${ew.customSqlSegment}
    </select>

    <select id="getAllByRoleId" resultType="com.orderway.system.bus.modular.app.entity.SysApp">
        select distinct *
        from sys_app
        where code in (
            select app_code
            from sys_role a
            where a.id = #{id}
        )
    </select>

    <select id="getAllAppByUserId" resultType="map">
        SELECT a.code, a.name, a.active, a.id, a.sort, a.url, a.path_name,a.p_type, a.url_type
        from sys_app a
        where a.code in (
            select b.app_code
            from sys_role b
            where b.id in
                  (
                      SELECT c.role_id
                      from sys_user_role c
                      where c.user_id = #{id}
                  )
        ) order by a.sort desc
        ;
    </select>

    <select id="getAllByRoleIds" resultType="com.orderway.system.bus.modular.app.entity.SysApp">
        select * from sys_app where 1=1 and status  = 0 and  code in
        (
        select DISTINCT app_code from sys_role where id in
        <foreach collection="list" item="i" separator="," open="(" close=")">
            #{i}
        </foreach>
        )
    </select>

    <select id="checkCode" resultType="integer">
        select count(*)
        from sys_role b
        where b.id in (
            select a.role_id from sys_user_role a where a.user_id = #{userId}
        )
          and b.app_code = #{code}
    </select>

    <select id="get_all_app" resultType="map">
        select id as appId, name, code
        from sys_app where status = 0
    </select>

</mapper>
