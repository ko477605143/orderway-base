<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.orderway.system.bus.modular.role.mapper.SysRoleMapper">


    <select id="getPage" resultType="map">
        select t1.id,
               t1.name,
               t1.code,
               t1.sort,
               t1.data_scope_type,
               t1.remark,
               t2.id   as appId,
               t2.name as appName,
               t2.code as appCode
        from sys_role t1
                 left join sys_app t2 on t1.app_code = t2.code
            ${ew.customSqlSegment}
    </select>

    <select id="getAllByUserId" resultType="map">
        select distinct a.id,
                        a.name,
                        a.code,
                        a.sort,
                        a.data_scope_type,
                        a.remark,
                        a.status,
                        a.app_code,
                        b.name app_name,
                        b.id   app_id
        from sys_role a
                 left join sys_app b on a.app_code = b.code
        where a.id in
              (
                  SELECT b.role_id
                  from sys_user_role b
                  where b.user_id = #{id}
              )
    </select>

    <select id="getRolesByCode" resultType="map">
        select *
        from sys_role a
        where a.app_code = #{code}
          and a.id in (
            select b.role_id
            from sys_user_role b
            where b.user_id = #{userId}
        )
    </select>

    <select id="getUserByToken" resultType="map">
        select *
            from sys_user
                where id in (
                    SELECT user_id
                    FROM sys_user_role
                        where role_id in (
                            select a.id
                            from sys_role a
                            where id in (
                                select role_id
                                from sys_user_role
                                where user_id = #{userId}
                                )
                                <if test="roleCode != null and roleCode != ''">
                                    and a.code = #{roleCode}
                                </if>
                        )
                )
    </select>
        <!--    -->
    <select id="getAllRole" resultType="map">
        select id,name,code,sort from sys_role where status = 0 ORDER BY sort  asc
    </select>
</mapper>
